<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Understanding what new code does without reading it | Software and puns</title>



<link href="http://petr-tik.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Software and puns" />

<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="http://petr-tik.github.io/posts/tracing_instead_of_reading/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="http://petr-tik.github.io/">
          <h1 class="title is-4">Software and puns</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/petr-tik'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/petr_tik'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">whoami</h2>
        </a></div>
      

      
    </nav>

  </div>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/rust">#rust</a>



  
  | <a class="subtitle is-6" href="/tags/tantivy">#tantivy</a>
  

      
    </div>
    <h2 class="subtitle is-6">December 15, 2019</h2>
    <h1 class="title">Understanding what new code does without reading it</h1>
    
    <div class="content">
      <p>I recently started working on a ticket in tantivy that allows users to <a href="https://github.com/tantivy-search/tantivy/issues/547">customise
the weight of a field</a> by increasing/decreasing the score of documents that match
the query in a specific field.</p>
<p>Tantivy is a rust library to build search engines and we are working on new features while keeping track of performance - <a href="https://tantivy-search.github.io/bench/">benchmarks here</a>.</p>
<h2 id="previous-understanding">Previous understanding</h2>
<p>From working on the tantivy codebase before (including extending the range query
syntax), I have a high-level understanding of the cycle from query to SERPs (Search Engine Result Page).</p>
<p>My understanding so far:</p>
<blockquote>
<p>(Query comes in) -&gt; (Query parsed to an AST consisting of several BooleanQuery instances)</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<pre><code>               V
</code></pre>
<p>(Each BooleanQuery runs over the index)</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<pre><code>                       V
</code></pre>
<p>(Scores from sub-queries are combined in the top-level query)</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<pre><code>                             V
</code></pre>
<p>(Relevant documents are retrieved, ordered by their score and returned)</p>
</blockquote>
<p>Since this feature will require changing several components at the same time, I
will need to understand them in finer detail, so I don&rsquo;t change the semantics
unintentionally.</p>
<p>I also suspect that I am misunderstanding and/or missing stages in this pipeline, which will be roadblocks to implement this PR.</p>
<h2 id="how-would-you-dig-into-this">How would you dig into this?</h2>
<p>Most people would sit down and read the code, going from function to function starting from the query being parsed.</p>
<p>I wanted to try something new instead.</p>
<h2 id="what-am-i-going-to-do-instead">What am I going to do instead?</h2>
<p>I will create an example tantivy-based search application that runs user
provided queries. Running a debug build (with symbols preserved) application on a small index, I will collect a
trace and work through the stacktrace created by the query.</p>
<h3 id="why">Why?</h3>
<p>Given the depth of the query lifecycle, I find it easier to observe a real
instance of the application and map it to the source code than reading the
source code to replay the situation in my head.</p>
<p>Also, I think it&rsquo;s fun to use other tools and see what else I might find.</p>
<h2 id="how-are-you-going-to-do-that">How are you going to do that?</h2>
<p>Let&rsquo;s create a basic rust example that will work on an index (in a tempdir) and process queries.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#080;font-style:italic">// Taken from the basic_example.rs
</span><span style="color:#080;font-style:italic"></span><span style="color:#a2f;font-weight:bold">use</span><span style="color:#bbb"> </span>tantivy::collector::TopDocs;<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">use</span><span style="color:#bbb"> </span>tantivy::query::QueryParser;<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">use</span><span style="color:#bbb"> </span>tantivy::schema::<span style="color:#666">*</span>;<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">use</span><span style="color:#bbb"> </span>tantivy::{doc,<span style="color:#bbb"> </span>Index,<span style="color:#bbb"> </span>ReloadPolicy};<span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">use</span><span style="color:#bbb"> </span>tempfile::TempDir;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">fn</span> <span style="color:#00a000">main</span>()<span style="color:#bbb"> </span>-&gt; <span style="color:#00f">tantivy</span>::<span style="color:#a2f">Result</span><span style="color:#666">&lt;</span>()<span style="color:#666">&gt;</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>index_path<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>TempDir::new()<span style="color:#666">?</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">mut</span><span style="color:#bbb"> </span>schema_builder<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>Schema::builder();<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema_builder.add_text_field(<span style="color:#b44">&#34;title&#34;</span>,<span style="color:#bbb"> </span>TEXT<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span>STORED);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>schema_builder.add_text_field(<span style="color:#b44">&#34;body&#34;</span>,<span style="color:#bbb"> </span>TEXT);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>schema<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>schema_builder.build();<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>index<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>Index::create_in_dir(<span style="color:#666">&amp;</span>index_path,<span style="color:#bbb"> </span>schema.clone())<span style="color:#666">?</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">mut</span><span style="color:#bbb"> </span>index_writer<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>index.writer(<span style="color:#666">50_000_000</span>)<span style="color:#666">?</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>title<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>schema.get_field(<span style="color:#b44">&#34;title&#34;</span>).unwrap();<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>body<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>schema.get_field(<span style="color:#b44">&#34;body&#34;</span>).unwrap();<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">mut</span><span style="color:#bbb"> </span>old_man_doc<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>Document::default();<span style="color:#bbb">
</span><span style="color:#bbb">    </span>old_man_doc.add_text(title,<span style="color:#bbb"> </span><span style="color:#b44">&#34;The Old Man and the Sea&#34;</span>);<span style="color:#bbb">
</span><span style="color:#bbb">    </span>old_man_doc.add_text(<span style="color:#bbb">
</span><span style="color:#bbb">        </span>body,<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="">&#34;</span>He<span style="color:#bbb"> </span>was<span style="color:#bbb"> </span>an<span style="color:#bbb"> </span>old<span style="color:#bbb"> </span>man<span style="color:#bbb"> </span>who<span style="color:#bbb"> </span>fished<span style="color:#bbb"> </span>alone<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>a<span style="color:#bbb"> </span>skiff<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>Gulf<span style="color:#bbb"> </span>Stream<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">         </span>he<span style="color:#bbb"> </span>had<span style="color:#bbb"> </span>gone<span style="color:#bbb"> </span>eighty<span style="color:#666">-</span>four<span style="color:#bbb"> </span>days<span style="color:#bbb"> </span>now<span style="color:#bbb"> </span>without<span style="color:#bbb"> </span>taking<span style="color:#bbb"> </span>a<span style="color:#bbb"> </span>fish.<span style="">&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>index_writer.add_document(old_man_doc);<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>index_writer.add_document(doc<span style="color:#666">!</span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>title<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;Of Mice and Men&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>body<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="">&#34;</span>A<span style="color:#bbb"> </span>few<span style="color:#bbb"> </span>miles<span style="color:#bbb"> </span>south<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>Soledad,<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>Salinas<span style="color:#bbb"> </span>River<span style="color:#bbb"> </span>drops<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>close<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>hillside<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>bank<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>runs<span style="color:#bbb"> </span>deep<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>green.<span style="color:#bbb"> </span>The<span style="color:#bbb"> </span>water<span style="color:#bbb"> </span>is<span style="color:#bbb"> </span>warm<span style="color:#bbb"> </span>too,<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">for</span><span style="color:#bbb"> </span>it<span style="color:#bbb"> </span>has<span style="color:#bbb"> </span>slipped<span style="color:#bbb"> </span>twinkling<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>over<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>yellow<span style="color:#bbb"> </span>sands<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>sunlight<span style="color:#bbb"> </span>before<span style="color:#bbb"> </span>reaching<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>narrow<span style="color:#bbb"> </span>pool.<span style="color:#bbb"> </span>On<span style="color:#bbb"> </span>one<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>side<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>river<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>golden<span style="color:#bbb"> </span>foothill<span style="color:#bbb"> </span>slopes<span style="color:#bbb"> </span>curve<span style="color:#bbb"> </span>up<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>strong<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>rocky<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>Gabilan<span style="color:#bbb"> </span>Mountains,<span style="color:#bbb"> </span>but<span style="color:#bbb"> </span>on<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>valley<span style="color:#bbb"> </span>side<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>water<span style="color:#bbb"> </span>is<span style="color:#bbb"> </span>lined<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>trees<span style="">—</span>willows<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>fresh<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>green<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>every<span style="color:#bbb"> </span>spring,<span style="color:#bbb"> </span>carrying<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>their<span style="color:#bbb"> </span>lower<span style="color:#bbb"> </span>leaf<span style="color:#bbb"> </span>junctures<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>debris<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>winter<span style="">’</span>s<span style="color:#bbb"> </span>flooding;<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>sycamores<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>mottled,<span style="color:#bbb"> </span>white,<span style="color:#bbb"> </span>recumbent<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>limbs<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>branches<span style="color:#bbb"> </span>that<span style="color:#bbb"> </span>arch<span style="color:#bbb"> </span>over<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>pool<span style="">&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>));<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>index_writer.add_document(doc<span style="color:#666">!</span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>title<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;Of Mice and Men&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>body<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="">&#34;</span>A<span style="color:#bbb"> </span>few<span style="color:#bbb"> </span>miles<span style="color:#bbb"> </span>south<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>Soledad,<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>Salinas<span style="color:#bbb"> </span>River<span style="color:#bbb"> </span>drops<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>close<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>hillside<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>bank<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>runs<span style="color:#bbb"> </span>deep<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>green.<span style="color:#bbb"> </span>The<span style="color:#bbb"> </span>water<span style="color:#bbb"> </span>is<span style="color:#bbb"> </span>warm<span style="color:#bbb"> </span>too,<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">for</span><span style="color:#bbb"> </span>it<span style="color:#bbb"> </span>has<span style="color:#bbb"> </span>slipped<span style="color:#bbb"> </span>twinkling<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>over<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>yellow<span style="color:#bbb"> </span>sands<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>sunlight<span style="color:#bbb"> </span>before<span style="color:#bbb"> </span>reaching<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>narrow<span style="color:#bbb"> </span>pool.<span style="color:#bbb"> </span>On<span style="color:#bbb"> </span>one<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>side<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>river<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>golden<span style="color:#bbb"> </span>foothill<span style="color:#bbb"> </span>slopes<span style="color:#bbb"> </span>curve<span style="color:#bbb"> </span>up<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>strong<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>rocky<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>Gabilan<span style="color:#bbb"> </span>Mountains,<span style="color:#bbb"> </span>but<span style="color:#bbb"> </span>on<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>valley<span style="color:#bbb"> </span>side<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>water<span style="color:#bbb"> </span>is<span style="color:#bbb"> </span>lined<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>trees<span style="">—</span>willows<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>fresh<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>green<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>every<span style="color:#bbb"> </span>spring,<span style="color:#bbb"> </span>carrying<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>their<span style="color:#bbb"> </span>lower<span style="color:#bbb"> </span>leaf<span style="color:#bbb"> </span>junctures<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>debris<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>winter<span style="">’</span>s<span style="color:#bbb"> </span>flooding;<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>sycamores<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>mottled,<span style="color:#bbb"> </span>white,<span style="color:#bbb"> </span>recumbent<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">            </span>limbs<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>branches<span style="color:#bbb"> </span>that<span style="color:#bbb"> </span>arch<span style="color:#bbb"> </span>over<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>pool<span style="">&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>));<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>index_writer.add_document(doc<span style="color:#666">!</span>(<span style="color:#bbb">
</span><span style="color:#bbb">    </span>title<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;Frankenstein&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>title<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;The Modern Prometheus&#34;</span>,<span style="color:#bbb">
</span><span style="color:#bbb">    </span>body<span style="color:#bbb"> </span><span style="color:#666">=&gt;</span><span style="color:#bbb"> </span><span style="">&#34;</span>You<span style="color:#bbb"> </span>will<span style="color:#bbb"> </span>rejoice<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span>hear<span style="color:#bbb"> </span>that<span style="color:#bbb"> </span>no<span style="color:#bbb"> </span>disaster<span style="color:#bbb"> </span>has<span style="color:#bbb"> </span>accompanied<span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>commencement<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>an<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">             </span>enterprise<span style="color:#bbb"> </span>which<span style="color:#bbb"> </span>you<span style="color:#bbb"> </span>have<span style="color:#bbb"> </span>regarded<span style="color:#bbb"> </span>with<span style="color:#bbb"> </span>such<span style="color:#bbb"> </span>evil<span style="color:#bbb"> </span>forebodings.<span style="color:#bbb">  </span>I<span style="color:#bbb"> </span>arrived<span style="color:#bbb"> </span>here<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">             </span>yesterday,<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span>my<span style="color:#bbb"> </span>first<span style="color:#bbb"> </span>task<span style="color:#bbb"> </span>is<span style="color:#bbb"> </span>to<span style="color:#bbb"> </span>assure<span style="color:#bbb"> </span>my<span style="color:#bbb"> </span>dear<span style="color:#bbb"> </span>sister<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>my<span style="color:#bbb"> </span>welfare<span style="color:#bbb"> </span>and<span style="color:#bbb"> </span><span style="">\</span><span style="color:#bbb">
</span><span style="color:#bbb">             </span>increasing<span style="color:#bbb"> </span>confidence<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>success<span style="color:#bbb"> </span>of<span style="color:#bbb"> </span>my<span style="color:#bbb"> </span>undertaking.<span style="">&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>));<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>index_writer.commit()<span style="color:#666">?</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>reader<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>index<span style="color:#bbb">
</span><span style="color:#bbb">        </span>.reader_builder()<span style="color:#bbb">
</span><span style="color:#bbb">        </span>.reload_policy(ReloadPolicy::OnCommit)<span style="color:#bbb">
</span><span style="color:#bbb">        </span>.try_into()<span style="color:#666">?</span>;<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>searcher<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>reader.searcher();<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic">// We care about the functions in this block             ------------------|
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>query_parser<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>QueryParser::for_index(<span style="color:#666">&amp;</span>index,<span style="color:#bbb"> </span>vec<span style="color:#666">!</span>[title,<span style="color:#bbb"> </span>body]);<span style="color:#bbb">  </span><span style="color:#080;font-style:italic">//  |
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">                                                                           </span><span style="color:#080;font-style:italic">//  |
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>query<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>query_parser.parse_query(<span style="color:#b44">&#34;sea whale&#34;</span>)<span style="color:#666">?</span>;<span style="color:#bbb">                    </span><span style="color:#080;font-style:italic">//  |
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">                                                                           </span><span style="color:#080;font-style:italic">//  |
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>top_docs<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>searcher.search(<span style="color:#666">&amp;</span>query,<span style="color:#bbb"> </span><span style="color:#666">&amp;</span>TopDocs::with_limit(<span style="color:#666">10</span>))<span style="color:#666">?</span>;<span style="color:#bbb">     </span><span style="color:#080;font-style:italic">//  |
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic">//                                                      -------------------|
</span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">for</span><span style="color:#bbb"> </span>(_score,<span style="color:#bbb"> </span>doc_address)<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>top_docs<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">let</span><span style="color:#bbb"> </span>retrieved_doc<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>searcher.doc(doc_address)<span style="color:#666">?</span>;<span style="color:#bbb">
</span><span style="color:#bbb">        </span>println<span style="color:#666">!</span>(<span style="color:#b44">&#34;{}&#34;</span>,<span style="color:#bbb"> </span>schema.to_json(<span style="color:#666">&amp;</span>retrieved_doc));<span style="color:#bbb">
</span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#a2f">Ok</span>(())<span style="color:#bbb">
</span><span style="color:#bbb"></span>}<span style="color:#bbb">
</span></code></pre></div><p>So, I wrote this small example and only needed to run it with perf. However,
due to my machine setup I have to run a custom, newer than standard Ubuntu
version of the kernel (5.2.0-050200-generic), which doesn&rsquo;t have linux-tools in the apt repository.</p>
<p>Git cloned the linux kernel, checked out
0ecfebd2b52404ae0c54a878c872bb93363ada36, ran <code>make</code> in <code>/tools/perf</code> but it
came up with too few options.</p>
<p>It was time to say a word of appreciation for everyone involved in
seemless package management for major Linux distributions, which enables me
to <code>sudo apt install *</code> most packages without worrying about their
dependencies.</p>
<h2 id="call-with-paul">Call with Paul</h2>
<p>Understanding of the code so far:</p>
<p>```
let query = query_parser.parse_query(&ldquo;body:\&ldquo;shared by both\&rdquo; OR body:fish&rdquo;)?;
```</p>
<p>A query comes in -&gt; QueryParser converts it into a UserInputAST, consisting of several BooleanQuery instances -&gt; Query makes a Weights for every SegmentCollector -&gt; Every SegmentCollector creates fruits -&gt; Fruits are merged into a top-K max-heap, which is returned</p>
<p>My questions are:</p>
<ol>
<li>Is the understanding above correct?</li>
<li>Given a segment and a document, where does the score come from and how is it combined?</li>
<li>Given a query with multiple subqueries - how are their scores combined?</li>
<li>When a query has</li>
</ol>

      
    </div>
    
  </div>
</section>




<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>



</body>
</html>


