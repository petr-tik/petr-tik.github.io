<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Use dumb technology | Software and puns</title>



<link href="http://petr-tik.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Software and puns" />

<link rel="stylesheet" href="/css/style.css"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="http://petr-tik.github.io/posts/is_hpc_linux_a_unikernel/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="http://petr-tik.github.io/">
          <h1 class="title is-4">Software and puns</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/petr-tik'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/petr_tik'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      
      <div class="nav-left"><a class="nav-item" href="/about">
          <h2 class="title is-5">whoami</h2>
        </a></div>
      

      
    </nav>

  </div>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/kernel">#kernel</a>



      
    </div>
    <h2 class="subtitle is-6">January 4, 2020</h2>
    <h1 class="title">Use dumb technology</h1>
    
    <div class="content">
      <p>Bjarne Stroutsop once said that <code>Inside C++ there is a smaller, simpler language trying to get out</code>. From my thought experiments, <!-- raw HTML omitted -->limited<!-- raw HTML omitted --> understanding and conversations with practitioners, I think that there might be a unikernel trying to get out of Linux.</p>
<p>Looking at areas where Linux is used as a high-performance foundation layer in latency-critical environments, one of the most useful characteristics of Linux seems to be the interface that allows programmers to minimise their reliance on the OS itself.</p>
<p>One such field is automated trading systems, where receiving networking packets,
running them through a maths model and sending outbound requests microseconds
slower can cost you real money, really quickly.</p>
<p>People building such systems follow several principles:</p>
<ol>
<li>
<p>Avoid the kernel wherever possible</p>
</li>
<li>
<p>If you need something from the kernel, minimise interactions with it</p>
</li>
<li>
<p>Choose HW-friendly data structures to keep CPU caches warm</p>
</li>
<li>
<p>Avoid the kernel</p>
</li>
</ol>
<p>The OS manages the hardware, which means your application needs to ask the OS
for permission every time you want to access files, send network packets or acquire more memory.
Making system calls (syscalls for short) to get those permissions from the kernel involves a costly
context switch.</p>
<p>Many tricks and kernel bypasses have been developed to avoid interacting with the OS.</p>
<p>1.1. User-space networking</p>
<p>If your main problem is how to receive and process network packets efficiently,
making 2 context switches for every packet is prohibitively expensive.</p>
<p>While Linux ships with a highly optimised TCP/IP network stack, many people go
out of their way to avoid using it. Instead, low-latency NIC manufacturers ship
a user-space library with a TCP/IP stack and give their cards an interface to
map network buffers directly to memory of your process.</p>
<p>This looks awfully familiar to the driver-model adopted by unikernels, which
provides speed as well as increasing safety guarantees that errors in networking
will be minimised.</p>
<p>1.2. Lock-free structures</p>
<p>One of the way of making resources thread-safe is with mutual exclusivity
primitives like locks, which uses the <code>futex</code> syscall on Linux. Not only does
this involve a system call, it might also lead to contention and starving
inactive threads by locking the resource that they need to proceed.</p>
<p>Adopting lock-free algorithms and structures allows us to avoid these problems.</p>
<p>My high-level explanation of lock-free vs locking is lowering contention from
kernel level (futex) to hardware-level (atomic integer instructions). In
practice, mutexes use a combination of atomics and system calls.</p>

      
    </div>
    
  </div>
</section>




<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>



</body>
</html>


