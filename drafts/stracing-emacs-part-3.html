<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My blog, ">

        <link rel="alternate"  href="/feeds/all.atom.xml" type="application/atom+xml" title="My blog Full Atom Feed"/>

        <title>Stracing emacs. Part 3 // My blog // </title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/theme/css/pure.css">
    <link rel="stylesheet" href="/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img" style="background: none repeat scroll 0% 0% #3D4F5D">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href="">My blog</a></h1>
                            <p class="tagline"></p>
                                <p class="links"><a href="/pages/about">About</a></p>
                                <p class="social">
                                    <a href="https://github.com/petr-tik">
                                        <i class="fa fa-GitHub fa-3x"></i>
                                    </a>
                                    <a href="https://twitter.com/petr_tik">
                                        <i class="fa fa-Twitter fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Stracing emacs. Part 3</h1>
                        <p class="post-meta">
                            // under                                 <a class="post-category" href="/tag/linux.html">linux</a>
                                <a class="post-category" href="/tag/tracing.html">tracing</a>
                                <a class="post-category" href="/tag/emacs.html">emacs</a>
                        </p>
                </header>
            </section>
            <h2>Top 10 by errors</h2>
<p>I won't repeat the same syscalls I investigated in previous parts, just the new ones. </p>
<div class="highlight"><pre><span class="nv">$$$$</span> tail -n <span class="m">67</span> emacs_strace_output <span class="p">|</span> head -n <span class="m">65</span> <span class="p">|</span> awk -F<span class="s2">&quot; &quot;</span> <span class="s1">&#39; { print $5, $6 }&#39;</span> <span class="p">|</span> grep ^<span class="o">[</span>0-9<span class="o">]</span> <span class="p">|</span> sort -nrk1
<span class="m">17979</span> open
<span class="m">3609</span> recvmsg
<span class="m">1446</span> faccessat
<span class="m">1143</span> readlinkat
<span class="m">119</span> stat
<span class="m">117</span> access
<span class="m">4</span> connect
<span class="m">2</span> statfs
<span class="m">2</span> rt_sigreturn
<span class="m">2</span> recvfrom
<span class="m">2</span> getxattr
<span class="m">1</span> wait4
<span class="m">1</span> <span class="nb">read</span>
</pre></div>


<ol>
<li>Take the summary table from the bottom of the output file. </li>
<li>Discard the bottom lines </li>
<li>take the last 2 columns (split by whitespace), which should give us the number of errors and the syscall. If no errors are present, it will just output the syscall name</li>
<li>Leave only the lines starting with a number i.e. those with a number of errors &gt; 0</li>
<li>numerically sort (in reverse order) by the values in the first column </li>
</ol>
<h2>faccessat</h2>
<div class="highlight"><pre>grep <span class="s2">&quot;^faccessat&quot;</span> emacs_strace_output <span class="p">|</span> grep -v <span class="s2">&quot; = 0&quot;</span>
</pre></div>


<h3>Sys call</h3>
<p>Checks if the user has permission to access the file.</p>
<p>Input:
  * int for directory file descriptor. The <code>AT_FDCWD</code> macro used to indicate current working directory. You can set another directory file descriptor and the pathname will be evaluated with respect to a different directory.
  * pathname
  * mode of access - F_OK checks for existence, R_OK, W_OK and X_OK for reading, writing and executing respectively.</p>
<h3>Errors</h3>
<p>Files that couldn't be accessed, because they don't exist. </p>
<div class="highlight"><pre>faccessat<span class="o">(</span>AT_FDCWD, <span class="s2">&quot;/home/petr_tik/.emacs.d/elpa/highlight-indentation-20161012.209.signed&quot;</span>, F_OK<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
faccessat<span class="o">(</span>AT_FDCWD, <span class="s2">&quot;/home/petr_tik/.emacs.d/elpa/ido-ubiquitous-20140526.1306.signed&quot;</span>, F_OK<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
faccessat<span class="o">(</span>AT_FDCWD, <span class="s2">&quot;/home/petr_tik/.emacs.d/elpa/irony-20170313.1437.signed&quot;</span>, F_OK<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
faccessat<span class="o">(</span>AT_FDCWD, <span class="s2">&quot;/home/petr_tik/.emacs.d/elpa/ivy-20170202.223.signed&quot;</span>, F_OK<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
faccessat<span class="o">(</span>AT_FDCWD, <span class="s2">&quot;/home/petr_tik/.emacs.d/elpa/json-mode-20160803.1606.signed&quot;</span>, F_OK<span class="o">)</span> <span class="o">=</span> -1 ENOENT <span class="o">(</span>No such file or directory<span class="o">)</span>
.
.
.
<span class="nv">$$$$</span> grep <span class="s2">&quot;^faccessat&quot;</span> emacs_strace_output <span class="p">|</span> grep -v <span class="s2">&quot; = 0&quot;</span> <span class="p">|</span> grep -c <span class="s2">&quot;.signed&quot;</span>
82
<span class="nv">$$$$</span> tree ~/.emacs.d/elpa/ <span class="p">|</span> grep -c <span class="s2">&quot;.signed&quot;</span>
6
<span class="nv">$$$$</span> grep <span class="s2">&quot;^faccessat&quot;</span> emacs_strace_output <span class="p">|</span> grep -c <span class="s2">&quot;W_OK&quot;</span>
8
<span class="nv">$$$$</span> grep <span class="s2">&quot;^faccessat&quot;</span> emacs_strace_output <span class="p">|</span> grep -v <span class="s2">&quot; = 0&quot;</span> <span class="p">|</span> grep -c <span class="s2">&quot;W_OK&quot;</span>
0
<span class="nv">$$$$</span> grep <span class="s2">&quot;^faccessat&quot;</span> emacs_strace_output <span class="p">|</span> grep -v <span class="s2">&quot; = 0&quot;</span> <span class="p">|</span> grep -c <span class="s2">&quot;R_OK&quot;</span>
111
<span class="nv">$$$$</span> grep <span class="s2">&quot;^faccessat&quot;</span> emacs_strace_output <span class="p">|</span> grep -v <span class="s2">&quot; = 0&quot;</span> <span class="p">|</span> grep -c <span class="s2">&quot;X_OK&quot;</span>
76
</pre></div>


<p>111 files couldn't be read by emacs. </p>
<p>82 .signed files couldn't be accessed and only 6 .signed files are in the directory (recursively checking). </p>
<p>No files failed to open when emacs checked, if it can write to them. </p>
<h2>readlinkat</h2>
<h2>access</h2>
            <a href="#" class="go-top">Go Top</a>
<footer class="footer">
    <p>&copy; Petr Tikilyaynen &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

</body>
</html>