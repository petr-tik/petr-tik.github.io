<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My blog, ">

        <link rel="alternate"  href="/feeds/all.atom.xml" type="application/atom+xml" title="My blog Full Atom Feed"/>

        <title>Remote (rust) development environment // My blog // </title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/theme/css/pure.css">
    <link rel="stylesheet" href="/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img" style="background: none repeat scroll 0% 0% #3D4F5D">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href="">My blog</a></h1>
                            <p class="tagline"></p>
                                <p class="social">
                                    <a href="https://github.com/petr-tik">
                                        <i class="fa fa-GitHub fa-3x"></i>
                                    </a>
                                    <a href="https://twitter.com/petr_tik">
                                        <i class="fa fa-Twitter fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>Remote (rust) development environment</h1>
                        <p class="post-meta">
                            // under                                 <a class="post-category" href="/tag/rust.html">rust</a>
                                <a class="post-category" href="/tag/infra.html">infra</a>
                        </p>
                </header>
            </section>
            <h2>Problem</h2>
<p>Working on large-ish Rust projects using a resource constrained laptop means your compile times are longer and your battery life is worse. If you have a VPS it might be easier to use your laptop as a terminal and use the VPS for CPU-heavy compiles. This post outlines my design to keep my laptop running for longer, while saving resource. </p>
<h2>What are we working with?</h2>
<p>I use emacs, which comes with tramp for remote access and editing and it works like a charm.</p>
<p>I also have a laptop that I chose for its weight and ergonomics rather than CPU and RAM characteristics. While it might change in the future, cloud compute offers are currently racing to the bottom wrt price to the consumer, so I might as well use it, while there is plenty of VC money.</p>
<h2>MVP</h2>
<p>Rust projects will be copied, synced (or sunk), built on VPS. Code changes will be mirrored back and release executables will be sent across as well. </p>
<h3>Mirror layout</h3>
<p>Below is a typical rust directory layout. </p>
<div class="highlight"><pre><span></span>typical_rust_dir/
├── Cargo.toml
├── doc/
├── src/
├── target/
└── tests/
</pre></div>


<p>I want to sync Cargo.toml as well as everything in <code>src/</code> and <code>tests/</code> directories. We can use the bash script below to find executables inside the target release folder.</p>
<div class="highlight"><pre><span></span>find target/release/ -maxdepth <span class="m">1</span> -type f -executable
</pre></div>


<h2>Tools</h2>
<ul>
<li>Unison</li>
<li>VPS </li>
<li>Laptop</li>
<li>Bash scripts for glue</li>
</ul>
<h2>Outline</h2>
<p>I need a system that checks for an internet connection and defaults to the VPS, if there is one. If the laptop isn't connected, I continue to work locally. </p>
<p>If I can reach the VPS, the rust project that I am working on, should be copied to the VPS and all queries for that file should be resolved with tramp. for</p>
<p>Unison will watch the changes </p>
<p>Local -&gt; VPS</p>
<p>On every connection, check if a project already exists and if it does update it. If it doesn't push out the files that are specified in the config. </p>
<p>VPS -&gt; Local</p>
<p>While I am working on the project in trump an instance should be watching the files in the config and mirroring the changes back down to my laptop. </p>
<h2>Benefits</h2>
<ul>
<li>
<p>Fast builds! Keep the same laptop and get faster builds by getting a faster VPS.</p>
</li>
<li>
<p>Save disk space locally. </p>
</li>
<li>
<p>Update <code>~/.cargo/bin/</code> by compiling it on VPS and mirroring to local <code>~/.cargo/bin/</code>. Not sure, if it's that easy considering that <code>rustup</code> manages all of this for you. </p>
</li>
</ul>
<h2>Drawbacks</h2>
<ul>
<li>
<p>Need to keep the environment (Linux, environment vars, rust toolchain) in sync across machines. </p>
</li>
<li>
<p>If connection fails during a dev/debugging session, I won't have debug symbols or any dependencies locally, so will need to rebuild from scratch. </p>
</li>
<li>
<p>More network traffic - minor risk of hitting the bandwidth quota for my VPS. Hence limit mirroring to source code and release binaries. </p>
</li>
<li>
<p>Not running into disk problems locally will make me forget how much I am using up in the VPS.</p>
</li>
</ul>
<h2>Work outside/after implementing this</h2>
<p>Upgrade VPS to current Linux version locally.
Write a script to keep local and VPS updated/on par in all aspects.
Check that that cargo run can work without any other libraries/binaries apart from <code>target/release/executable</code>. 
Will need to mess around and make sure that cargo still works the same way over ssh. 
Set up a cargo-gc/clean-up</p>
<h2>Outcome</h2>
<p>Whenever possible CPU-heavy compilation will take place on the VPS. All source code changes will be updated, so at every point both local and VPS version of the code match. Apart from the source code, my laptop will also receive 
executables from <code>target/release</code>, leaving all the debug and dependencies on the VPS. </p>
            <a href="#" class="go-top">Go Top</a>
<footer class="footer">
    <p>&copy; Petr Tikilyaynen &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

</body>
</html>