<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My blog, ">

        <link rel="alternate"  href="/feeds/all.atom.xml" type="application/atom+xml" title="My blog Full Atom Feed"/>

        <title>How to update your changelog automatically // My blog // </title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/theme/css/pure.css">
    <link rel="stylesheet" href="/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="pure-g-r" id="layout">
        <div class="sidebar pure-u">
            <div class="cover-img" style="background: none repeat scroll 0% 0% #3D4F5D">
                <div class="cover-body">
                    <header class="header">
                        <hgroup>
                            <h1 class="brand-main"><a href="">My blog</a></h1>
                            <p class="tagline"></p>
                                <p class="social">
                                    <a href="https://github.com/petr-tik">
                                        <i class="fa fa-GitHub fa-3x"></i>
                                    </a>
                                    <a href="https://twitter.com/petr_tik">
                                        <i class="fa fa-Twitter fa-3x"></i>
                                    </a>
                                </p>
                        </hgroup>
                    </header>
                </div>
            </div>
        </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>How to update your changelog automatically</h1>
                        <p class="post-meta">
                            // under                                 <a class="post-category" href="/tag/bash.html">bash</a>
                                <a class="post-category" href="/tag/git.html">git</a>
                        </p>
                </header>
            </section>
            <p>If you ever needed a quick way to update your changelog - you should find the post below interesting. </p>
<h2>How did I get here?</h2>
<p>I have been using the SurfingKeys extension for Chrome and Firefox (thanks again for a great extension + shout-outs below). </p>
<p>After a recent update to 0.9.42, I clicked on the changelog option in browser and realised that the last version summarised in the changelog was 0.9.30. </p>
<p>All of development takes place on GitHub, so it is easy to fork and prepare a PR. </p>
<h2>How do you summarise changes since a given version?</h2>
<p>I needed to populate the changelog with all changes that have been committed since the last time the changelog was updated. The last tag was 0.4.1, so instead of using git tags, I needed to find another way. </p>
<p>So I wrote a bash script to dump a summary of all commits between last version in the changelog and current git HEAD. </p>
<p>Here it is in all its splendour. </p>
<div class="highlight"><pre><span></span>grep -oP -m1 <span class="s2">&quot;(?## )[0-9].+&quot;</span> pages/changelog.md <span class="p">|</span> xargs -I LAST_VERSION git log --format<span class="o">=</span><span class="s2">&quot;%H&quot;</span> --grep<span class="o">=</span><span class="s2">&quot;LAST_VERSION&quot;</span> <span class="p">|</span> xargs -I COMMIT_HASH git log --format<span class="o">=</span>%s%n%b COMMIT_HASH..HEAD
</pre></div>


<p>Let's break it down into constituent parts. </p>
<h2>Step one - find the latest version in the changelog</h2>
<p><code>grep -oP -m1 "(?## )[0-9].+" pages/changelog.md</code></p>
<p>Finds the first match (<code>-m1</code>) of the given regex in the changelog file. The changelog file is written in reverse chronological order, so the first entry is the latest version. </p>
<p><code>-oP</code> enables me to ignore the "## " at the start of the line to pass clean version number to the next stage. </p>
<h2>Step two - find git commit with given version in diff</h2>
<p><code>xargs -I LAST_VERSION git log --format="%H" --grep="LAST_VERSION"</code></p>
<p>This is where xargs magic begins. We define a variable name <code>LAST_VERSION</code>, which will be replaced with the given value. I taught myself a mnemonic to remember <code>-I</code> as Instead.</p>
<p>xargs is due to receive the most recent version number found in pages/changelog.md</p>
<h2>Step three - print every commit between now and then</h2>
<p><code>xargs -I COMMIT_HASH git log --format=%s%n%b COMMIT_HASH..HEAD</code></p>
<p>Using the same trick as above to substitute hash of the commit with the most last logged version found in pages/changelog.md</p>
<p><code>--format=%s%n%b</code> prints subject and body of every commit separated by a newline. </p>
<h2>Result</h2>
<p>You will have the dump of git log since the version that was last mentioned in the changelog. You can add it to the changelog and tidy it up before committing the new changelog.</p>
<h2>Shoutouts</h2>
<p>Brook Hong for developing such a great Chrome extension and later porting it to Firefox New Edition. 
Other contributors to Surfing Keys.
Douglas McIlroy - the creator of Unix pipelines</p>
            <a href="#" class="go-top">Go Top</a>
<footer class="footer">
    <p>&copy; Petr Tikilyaynen &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure-single">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>

</body>
</html>